<Window x:Class="LessonsManager.StudentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Student Panel"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        ResizeMode="NoResize"
        Background="#F5F1E8"
        FontFamily="Segoe UI">

    <Window.Resources>
        <SolidColorBrush x:Key="PrimaryBrown" Color="#6B4423"/>
        <SolidColorBrush x:Key="SecondaryBrown" Color="#8B5A3C"/>
        <SolidColorBrush x:Key="LightBrown" Color="#D4A574"/>
        <SolidColorBrush x:Key="BeigeBackground" Color="#F5F1E8"/>

        <Style x:Key="WindowsItemStyle" TargetType="Border">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F0E6D2"/>
                    <Setter Property="BorderBrush" Value="{StaticResource LightBrown}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- AppBar -->
        <Border Background="{StaticResource PrimaryBrown}" Height="58" DockPanel.Dock="Top">
            <Grid Margin="15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="BookOpenPageVariant" Width="24" Height="24" Foreground="White" Margin="0,0,10,0"/>
                    <TextBlock Text="פורטל תלמיד - ישיבת מהרי&quot;ל" 
                               FontWeight="Bold" FontSize="20" Foreground="White"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <Button Content="חבר התקן" 
                        Grid.Column="1" 
                        Background="{StaticResource SecondaryBrown}" 
                        Foreground="White"
                        Width="110" 
                        Margin="0,0,10,0"
                        Padding="10,5"
                        BorderThickness="0"
                        FontWeight="SemiBold"
                        Cursor="Hand"
                        Click="ConnectDeviceButton_Click"/>

                <Button Content="התנתק" 
                        Grid.Column="2" 
                        Background="#8B4513" 
                        Foreground="White"
                        Width="100" 
                        Padding="10,5"
                        BorderThickness="0"
                        FontWeight="SemiBold"
                        Cursor="Hand"
                        Click="Logout_Click"/>
            </Grid>
        </Border>

        <!-- תוכן -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="30">

                <!-- חיפוש וסינון -->
                <Border Background="White" CornerRadius="10" Padding="20" Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.2" Color="#000000"/>
                    </Border.Effect>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- שורה ראשונה: חיפוש -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="SearchTextBox"
                                    Grid.Column="0"
                                    Height="40"
                                    Padding="15,10"
                                    FontSize="14"
                                    BorderBrush="{StaticResource LightBrown}"
                                    BorderThickness="2"
                                    VerticalContentAlignment="Center"
                                    TextChanged="SearchTextBox_TextChanged">
                                <TextBox.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="8"/>
                                    </Style>
                                </TextBox.Resources>
                            </TextBox>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">

                                <Button x:Name="SearchButton"
                                        Content="חפש"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="20,10"
                                        Height="40"
                                        FontWeight="SemiBold"
                                        Cursor="Hand"
                                        Click="SearchButton_Click">
                                    <Button.Resources>
                                        <Style TargetType="{x:Type Border}">
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </Button.Resources>
                                    <Button.Background>
                                        <StaticResource ResourceKey="PrimaryBrown"/>
                                    </Button.Background>
                                </Button>

                                <Button x:Name="ToggleFiltersButton"
                                        Content="סינונים"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="20,10"
                                        Height="40"
                                        Margin="10,0,0,0"
                                        FontWeight="SemiBold"
                                        Cursor="Hand"
                                        Click="ToggleFiltersButton_Click">
                                    <Button.Resources>
                                        <Style TargetType="{x:Type Border}">
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </Button.Resources>
                                    <Button.Background>
                                        <StaticResource ResourceKey="SecondaryBrown"/>
                                    </Button.Background>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- שורה שנייה: סינונים (מוסתר כברירת מחדל) -->
                        <StackPanel x:Name="FiltersPanel" 
                                   Grid.Row="1" 
                                   Margin="0,15,0,0"
                                   Visibility="Collapsed">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- סינון לפי נושא -->
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="נושא:" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource PrimaryBrown}"/>
                                    <ComboBox x:Name="SubjectFilterComboBox"
                                            Height="36"
                                            SelectionChanged="FilterChanged"/>
                                </StackPanel>

                                <!-- סינון לפי תת-נושא -->
                                <StackPanel Grid.Column="1" Margin="0,0,10,0">
                                    <TextBlock Text="תת-נושא:" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource PrimaryBrown}"/>
                                    <ComboBox x:Name="SubSubjectFilterComboBox"
                                            Height="36"
                                            SelectionChanged="FilterChanged"/>
                                </StackPanel>

                                <!-- סינון לפי שנה -->
                                <StackPanel Grid.Column="2" Margin="0,0,10,0">
                                    <TextBlock Text="שנה:" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource PrimaryBrown}"/>
                                    <ComboBox x:Name="YearFilterComboBox"
                                            Height="36"
                                            SelectionChanged="FilterChanged"/>
                                </StackPanel>

                                <!-- כפתור איפוס -->
                                <Button Grid.Column="3"
                                       Content="אפס סינונים"
                                       Background="#E74C3C"
                                       Foreground="White"
                                       BorderThickness="0"
                                       Padding="15,8"
                                       Height="36"
                                       VerticalAlignment="Bottom"
                                       FontWeight="SemiBold"
                                       Cursor="Hand"
                                       Click="ResetFilters_Click">
                                    <Button.Resources>
                                        <Style TargetType="Border">
                                            <Setter Property="CornerRadius" Value="6"/>
                                        </Style>
                                    </Button.Resources>
                                </Button>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- סרגל ניווט -->
                <Border Background="White" CornerRadius="8" Padding="10,8" Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.15" Color="#000000"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal" Margin="0,0,15,0">
                            <Button x:Name="BackButton"
                                    Width="32" Height="32"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    ToolTip="אחורה"
                                    Cursor="Hand"
                                    Click="BackButton_Click">
                                <materialDesign:PackIcon Kind="ArrowRight" Width="18" Height="18" Foreground="{StaticResource PrimaryBrown}"/>
                            </Button>
                            <Button x:Name="HomeButton"
                                    Width="32" Height="32"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    ToolTip="דף הבית"
                                    Margin="5,0,0,0"
                                    Cursor="Hand"
                                    Click="HomeButton_Click">
                                <materialDesign:PackIcon Kind="Home" Width="18" Height="18" Foreground="{StaticResource PrimaryBrown}"/>
                            </Button>
                        </StackPanel>

                        <Border Grid.Column="1" 
                                Background="#F5F5F5" 
                                CornerRadius="4" 
                                Padding="12,6"
                                BorderThickness="1"
                                BorderBrush="#E0E0E0">
                            <TextBlock x:Name="AddressBar" 
                                      Text="שיעורים" 
                                      VerticalAlignment="Center"
                                      Foreground="#444"/>
                        </Border>
                    </Grid>
                </Border>

                <!-- תוכן התיקייה -->
                <Border Background="White" CornerRadius="10" Padding="20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.2" Color="#000000"/>
                    </Border.Effect>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="500">
                        <ItemsControl x:Name="FolderItems">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Background="Transparent" 
                                            BorderThickness="0"
                                            Padding="0"
                                            Margin="5"
                                            Cursor="Hand"
                                            Click="ItemButton_Click"
                                            Width="140"
                                            Height="140">
                                        <Border Style="{StaticResource WindowsItemStyle}">
                                            <StackPanel HorizontalAlignment="Center">
                                                <Viewbox Width="64" Height="64" Margin="0,0,0,12">
                                                    <materialDesign:PackIcon>
                                                        <materialDesign:PackIcon.Style>
                                                            <Style TargetType="materialDesign:PackIcon">
                                                                <Setter Property="Kind" Value="FileMusic"/>
                                                                <Setter Property="Foreground" Value="#2196F3"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsFolder}" Value="True">
                                                                        <Setter Property="Kind" Value="Folder"/>
                                                                        <Setter Property="Foreground" Value="#D4A574"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </materialDesign:PackIcon.Style>
                                                    </materialDesign:PackIcon>
                                                </Viewbox>

                                                <TextBlock Text="{Binding Name}" 
                                                          TextAlignment="Center"
                                                          TextWrapping="Wrap"
                                                          FontSize="13"
                                                          Foreground="#333"
                                                          MaxWidth="130"/>
                                            </StackPanel>
                                        </Border>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>